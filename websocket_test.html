<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/>
		<title>Test Launch</title>
		<script language="javascript" type="text/javascript">
			var wsUri = "ws://localhost:8080/stream/";
			var output;

			function init() {
				output = document.getElementById("output");
				startWebsocket();
			}

			function startWebsocket() {
				var websocket = new WebSocket(wsUri);
				websocket.onopen = function(evt) {
					//the first message on the websocket must include the HMAC
					//authenticating the entire session.
					var msg = JSON.stringify({
						"hmac": "1--iFplvAUtzi_veq_dMKPfnjtg_SQ=",
						"cmd": "launch",
						"access-key": "xxx",
						"secret-key": "xxx",
						"regions": [
							{
								"region": "us-east-1",
								"vpcs": [
									{"id": "vpc-31a0cc54"}
								]
							}
						],
						"instance-size": "t2.micro"
					});
					websocket.send(msg);
				};

				websocket.onclose = function(evt) {

				};

				websocket.onmessage = function(evt) {
					var pre = document.createElement("p");
					pre.style.wordWrap = "break-word";
					var evt_data = JSON.parse(evt.data);
					pre.innerHTML = evt_data.Message.ResourceType + " - " + evt_data.Message.ResourceStatus;
					output.appendChild(pre);
				};

				websocket.onerror = function(evt) {

				};
			}

			window.addEventListener("load", init, false);
		</script>
	</head>
	<body>
	<div id="output">

	</div>
	</body>
</html>